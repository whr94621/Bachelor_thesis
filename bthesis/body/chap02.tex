\chapter{Stirling 公式余项~$\delta_n$ 的估计}
\label{chap02}

对于正整数的阶乘, 我们有~Stirling 公式作为渐近表示:
$$
n!=\sqrt{2\pi~n}(\frac{n}{e})^ne^{\delta_n},\delta_n=\frac{1}{12n}+\cdots. ~~\delta_n\to~0, ~~(n\to\infty)
$$
本章主要用两种方法估计~$\delta_n$: 函数的单调性定量估计(引自[6])和~Euler-Maclaurin 公式定性估计(引自[1]).

\section{用~Euler-Maclaurin~公式定性估计}

由~$\textbf{附录B}$的~$(B.1)$ 知: (Euler-Maclaurin公式)
\begin{align}
\int_0^1~f(s)ds & =\frac{1}{2}[f(0)+f(1)]-\sum_{k=1}^{m+1}\frac{B_{2k}}{(2k)!}[f^{(2k-1)}(1)-f^{(2k-1)}(0)]\nonumber\\
                & ~~~+\frac{1}{(2m+2)!}\int_0^1B_{2m+2}(s)f^{(2m+2)}(s)ds,
\end{align}
现在我们假设~$f^{2m}$ 和~$f^{2m+2}$ 在~$[0,1]$ 上具有相同的符号, 利用两次分部积分, 我们得到
$$\begin{aligned}
\int_0^1(B_{2m}(s)-B_{2m})f^{(2m)}(s)ds & =-B_{2m}[f^{(2m-1)}(1)-f^{(2m-1)}(0)] \\
                                        & ~~~+\frac{1}{2m+2}\int_0^1(B_{2m+2}(t)-B_{2m+2})f^{(2m+2)}(s)ds, 
\end{aligned}$$
根据~$\textbf{附录A}$ Bernoulli 多项式的\textbf{性质4}和\textbf{性质5}, 可知上式左边和右边第二项符号相反, 因而左边的符号与右边的第一项
的符号相同，且存在~$\theta\in(0,~1)$, 使得
$$
\int_0^1(B_{2m}(s)-B_{2m})f^{(2m)}(s)ds=-\theta\cdot~B_{2m}[f^{(2m-1)}(1)-f^{(2m-1)}(0)].
$$
这个结果可以作到一般区间~$[a,~b]$ 中去.


下面我们考虑定义在~$(1,+\infty)$ 的函数~$f(t)$. 假设

(*)~$f^{2k}$都具有相同的符号, 且~$f^{(2k+1)}\to~0~(t\to~\infty)$.

考虑~$f(t)$ 在区间~$[1,n]$ 上的积分. 将~$[1, n]$ 作~$n-1$ 等分, 在每一个小区间上运用~$(2.1)$
可以得到
$$
\int_1^nf(t)dt=\sum_{i=1}^nf(i)-\frac{1}{2}f(n)-\sum_{k=1}^m\frac{B_{2k}}{(2k)!}f^{(2k-1)}(n)+R_n,
$$
其中
$$\begin{aligned}
R_n & =-\frac{1}{2}f(1)-\sum_{k=1}^m\frac{B_{2k}}{(2k)!}f^{(2k-1)}(1) \\
    & ~~~+\frac{1}{(2m+2)!}\sum_{i=1}^{n-1}\int_0^1(B_{2m+2}(t)-B_{2m+2})f^{(2m+2)}(i+t)dt,
\end{aligned}$$
由条件~$(*)$不难看出极限~$\lim\limits_{n\rightarrow\infty}R_n$ 存在，记为~$R$, 于是
$$
R_n-R=\frac{1}{(2m+2)!}\sum_{i=n}^{\infty}\int_0^1(B_{2m+2}(t)-B_{2m+2})f^{(2m+2)}(i+t)dt,
$$
根据与上面类似的讨论并利用~$(*)$ 可以得到~$\theta_n\in(0,~1)$, 使得
$$
R_n-R=-\theta_n\frac{B_{2m+2}}{(2m+2)!}f^{(2m+2)}(n),
$$
于是得到下面的公式
\begin{align}
\int_1^nf(t)dt~&=\sum_{i=1}^nf(i)-\frac{1}{2}f(n)-\sum_{k=1}^m\frac{B_{2k}}{(2k)!}f^{(2k-1)}(n)\nonumber\\
~&~~~~~+R-\theta_n\frac{B_{2m+2}}{(2m+2)!}f^{(2m+1)}(n),\theta_n\in(0,~1).\nonumber
\end{align}
对函数~$f(t)=\ln{t}$~用这个公式，得
\begin{align}
n\ln{n}-n~&=C+\ln{(n!)}-\frac{1}{2}\ln{n}-\sum_{k=1}^m\frac{B_{2k}}{2k(2k-1)}\frac{1}{n^{2k-1}}\nonumber\\
~&~~~~~-\theta_n\frac{B_{2m+2}}{(2m+2)(2m+1)}\frac{1}{n^{2k+1}},\theta_n\in(0,~1).%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%{2.2)
\end{align}
把~$n!=\sqrt{2\pi~n}(\frac{n}{e})^ne^{\delta_n}$~代入~(2.2)~中，并令~$n\rightarrow\infty$~
可得~$C=-\frac{1}{2}\ln{2\pi}$~,且得到~$\mu(n)$~如下展式~$(**)$~(后面会用到)~
$$
\mu(n)=\sum_{k=1}^m\frac{B_{2k}}{2k(2k-1)}\frac{1}{n^{2k-1}}+\theta_n\frac{B_{2m+2}}{(2m+2)(2m+1)}\frac{1}{n^{2m+1}},\theta_n\in(0,1).
$$
例如，取~$m=1$~得
$$
\mu(n)=\frac{B_2}{2}\frac{1}{n}+\theta_n\frac{B_4}{12}\frac{1}{n^3}=\frac{1}{12n}-\frac{\theta_n}{360n^3},\theta_n\in(0,~1).
$$
再取~$m=2$~得
$$
\mu(n)=\frac{1}{12n}-\frac{1}{360n^3}+\frac{\theta_n}{1260n^5},\theta_n\in(0,~1).
$$
故可写为:
$$
n!=n^ne^{-n}\sqrt{2\pi~n}(1+\frac{1}{12n}+\frac{1}{288n^2}-\frac{139}{51480n^3}-\frac{571}{2488320n^4}+\cdots).
$$
此即我们所得到的\textbf{~Stirling~公式余项~$\delta_n$~估计}.

\section{用函数单调性定量估计}
由上知~$\delta_n$~可以写为
$$
\delta_n=\ln{\frac{n!e^n}{\sqrt{2\pi}n^{n+\frac{1}{2}}}}~~~(n=1,~2,~\cdots).
$$
且
$$
\lim_{n\rightarrow\infty}\delta_n~=0.
$$
有很多定量的形式关于~$\delta_n$~估计.~给出它的上界和下界,为了精确,由于~$\lim_{n\rightarrow\infty}\delta_n=0$~
故~$\delta_n$~可被一致的写为~$(****)$~(后面会用到)~
$$
\delta_n~\simeq~\frac{A}{n}-\frac{B}{n^3}+\frac{C}{n^5}-\frac{D}{n^7}+\cdots,
$$
这里的~$\simeq$~是指~$\delta_n$~在于两个逼近序列之间.事实上由上面的~Euler-Maclaurin~估计可以看出,下面我们通过一个简单的技巧介绍怎么
计算固定的常数~$A,B,C,\cdots$~.并且证明通过这种方法得到的是最好的.\\
下面我们引入一个显然的结论,记为\textbf{引理2.1}.\\
\textbf{引理2.1}~假如~$f(x)$~是严格的递减~(递增)~当~$x>0$~且~$\lim\limits_{x\rightarrow\infty}f(x)=0$,~那么有~$f(x)>0~~(f(x)<0),~\forall~x>0$~.

\textbf{定理2.1:}~序列~$\delta_n$~是严格的递减并且趋向于~0~.\\
\textbf{证明:}~我们有
$$
\delta_{n+1}-\delta_n~=1-(n+\frac{1}{2})\ln{(1+\frac{1}{n})}.
$$
欲证~$\delta_n$~递减，只须~$\ln{(1+\frac{1}{n})}-\frac{1}{n+\frac{1}{2}}~>0,\forall~n~>0$~.令
$$
f(x)~=\ln{(1+\frac{1}{x})}-\frac{1}{x+\frac{1}{2}}
$$
由于~$\lim\limits_{x\rightarrow\infty}f(x)=0$~且~$f'(x)=-\frac{1}{x(x+1)(2x+1)}<0$~,当~$x>0$~时，故由~$\textbf{引理2.1}$~
可得~$f(x)$~在~$(0,~+\infty)$~是严格递减的.当~$x$~取正整数时可知~$\ln{(1+\frac{1}{n})}-\frac{1}{n+\frac{1}{2}}~>0$~
故定理得证.

下面计算~$A,B,C,\cdots$~.\\
\textbf{第一步:}~确定~$A$~,使得~$0~<\delta_n<\frac{A}{n},\forall~n>0$~.\\
由于~$\delta_n$~趋向于~0~,$a_n~=\delta_n-\frac{A}{n}$也是趋向于~0~的.由~$\textbf{引理2.1}$~
可知,任何~$A>0$~使~$a_n$~严格递增的关于~n~的函数都满足我们的要求.于是有
$$
a_{n+1}-a_n~=1-(n+\frac{1}{2})\ln{(1+\frac{1}{n})}+A(\frac{1}{n}-\frac{1}{n+1})>0,\forall~n>0
$$
只须
$$
g(x)~=\frac{1}{x+\frac{1}{2}}-\ln(1+\frac{1}{x})+A\frac{\frac{1}{x}-\frac{1}{x+1}}{x+\frac{1}{2}}>0,\forall~x>0
$$
欲使上式成立,由于~$\lim\limits_{x\rightarrow\infty}g(x)=0$~,由~$\textbf{引理2.1}$~只须
\begin{equation}
g'(x)~=\frac{x(1+x)-A(12x^2+12x+2)}{x^2(x+1)^2(2x+1)^2}<0,\forall~x>0%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(2.3)
\end{equation}
只须
\begin{equation}
A~>\frac{x(x+1)}{12x^2+12x+2},\forall~x>0%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(2.4)
\end{equation}
由于(2.4)式右边的导数
$$
\frac{x+1}{2(6x^2+6x+1)^2}>0,\forall~x>0
$$
故(2.4)式右边递增的趋向于~$\frac{1}{12}$~.因此~A~的最佳选择为~$\frac{1}{12}$~.

\textbf{定理2.2:}~$0~<\delta_n~<\frac{1}{12n},\forall~n>0$~中的固定常数~$\frac{1}{12}$~不能再改进.\\
\textbf{证明:}~取常数~$A'$~代替~A~使得~$0~<A'<\frac{1}{12}$~.我们知道~(4.4)~式右边的函数递增的趋向于~$\frac{1}{12}$~.
由于~$A'$~比右边小,当右边的~x~充分大时.故存在~X~,使得~$g'(x)>0,\forall~x>X$~.于是由~$\textbf{引理2.1}$~有~$g(x)<0,\forall~x>X$~,
且~$a_{n+1}-a_n<0$~对于某个~$n=N$~.于是~$a_n>0,\forall~n>N$~,最终~$\delta_n>A',\forall~n>N$~.矛盾!即定理得证.

\textbf{第二步:}~确定~$B$~,使得~$\frac{1}{12n}-\frac{B}{n^3}~<\delta_n<\frac{1}{12n},\forall~n>0$~.\\
由于~$\delta_n$~趋向于~0~,$b_n~=\delta_n-\frac{1}{12n}+\frac{B}{n^3}$也是趋向于~0~的.由~$\textbf{引理2.1}$~
可知,任何~$B>0$~使~$a_n$~严格递减的关于~n~的函数都满足我们的要求.于是有
\begin{align}
b_{n+1}-b_n~&=1-(n+\frac{1}{2})\ln{(1+\frac{1}{n})}\nonumber\\
~~~~~~&+\frac{1}{12}(\frac{1}{n}-\frac{1}{n+1})-B(\frac{1}{n^3}-\frac{1}{(n+1)^3})<0,\forall~n>0\nonumber
\end{align}
只须
$$
h(x)~=\frac{1}{x+\frac{1}{2}}-\ln(1+\frac{1}{x})+\frac{1}{12}\frac{\frac{1}{x}-\frac{1}{x+1}}{x+\frac{1}{2}}
-B\frac{\frac{1}{x^3}-\frac{1}{(x+1)^3}}{x+\frac{1}{2}}<0,\forall~x>0
$$
欲使上式成立,由于~$\lim\limits_{x\rightarrow\infty}h(x)=0$~,由~$\textbf{引理2.1}$~只须
\begin{equation}
h'(x)~=-\frac{x^2(1+x)^2-12B(30x^4+60x^3+50x^2+20x+3)}{6x^4(1+x)^4(2x+1)^2}>0,\forall~x>0%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(2.5)
\end{equation}
只须
\begin{equation}
B~>\frac{x^2(1+x)^2}{12(30x^4+60x^3+50x^2+20x+3)},\forall~x>0%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%(2.6)
\end{equation}
由于(2.6)式右边的导数
$$
\frac{x(20x^4+50x^3+46x^2+19x+3}{6(30x^4+60x^3+50x^2+20x+3)^2}>0,\forall~x>0
$$
故(2.6)式右边递增的趋向于~$\frac{1}{360}$~.因此~B~的最佳选择为~$\frac{1}{360}$~.

\textbf{定理2.3:}~$\frac{1}{12n}-\frac{1}{360n^3}~<\delta_n<\frac{1}{12n},\forall~n>0$~中的固定常数~$\frac{1}{360}$~不能再改进.\\
证明过程仿照~$\textbf{定理2.2:}$~的证明.

按照这样继续下去，我们得到常数~$C~=\frac{1}{1260},D~=\frac{1}{1680},\cdots$~,并且可以得证~$(***)$~(后面会到)~
\begin{equation}
\delta_n~\simeq\frac{1}{12n}-\frac{1}{360n^3}+\frac{1}{1260n^5}-\frac{1}{1680n^7}+\frac{1}{1188n^9}-\cdots.%%%%%%%%%%%%%%%%%%(2.7)
\end{equation}
这些只是需要耐心的计算就可以得到.

注:仔佃比较两种方法中的~$(**),(***),(****)$~你会发现~$\delta_n$~中的常数可知
$$
A~=\frac{B_2}{1\cdot~2}, B~=-\frac{B_4}{3\cdot~4},
C~=\frac{B_6}{5\cdot~6}, D~=-\frac{B_8}{7\cdot~8}, \cdots
$$
其中~$B_i~(i~=2,4,6,\cdots)$~是~$\textbf{附录A}$~中的~Bernoulli~数,详情请看~$\textbf{附录A}$~.
